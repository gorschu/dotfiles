#!/bin/bash
# shellcheck disable=all
# Modify kitty.conf to add globinclude for config.d drop-ins

set -euo pipefail

# Read the existing config (or start with minimal header if it doesn't exist)
if [ ! -s /dev/stdin ]; then
  echo '# kitty configuration'
  echo ''
fi

# Process the config line by line
while IFS= read -r line; do
  # Skip existing globinclude lines - we'll add our own
  if [[ "$line" =~ ^globinclude[[:space:]] ]]; then
    continue
  fi
  echo "$line"
done

# Add our globinclude at the end
echo ""
echo "# Include drop-in configurations (managed by chezmoi)"
echo "globinclude config.d/*.conf"
