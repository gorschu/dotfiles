#!/bin/bash

set -Eeuxo pipefail

red=$(tput setaf 1)
green=$(tput setaf 2)
reset=$(tput sgr0)

echo "${green}Installing requirements${reset}"
{{ if eq .chezmoi.osRelease.id "ubuntu" "debian" }}
  sudo apt-get update && \
        sudo apt-get -y install git lsb-release curl zsh \
            tomb python3-pip gnupg2 pcscd scdaemon pcsc-tools \
            yubikey-manager
{{ else if eq .chezmoi.osRelease.id "arch" }}
    paru -S --noconfirm --needed git curl zsh run-parts unzip
{{ else if eq .chezmoi.osRelease.id "fedora" }}
    sudo dnf install -y git zsh redhat-lsb-core yubikey-manager
{{ else if eq .chezmoi.osRelease.id "opensuse-leap" "opensuse-tumbleweed" }}
    sudo zypper install -y git zsh
{{ end }}

echo "${green}Installing gita and cloning .vendor requirements${reset}"
[[ -e {{ .chezmoi.homeDir }}/.local/bin/gita ]] || pip3 install --user gita
gita clone -p {{ .chezmoi.sourceDir }}/.gita.vendor.frozen
