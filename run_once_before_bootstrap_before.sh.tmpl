#!/bin/bash

set -Eeuxo pipefail

red=$(tput setaf 1)
green=$(tput setaf 2)
reset=$(tput sgr0)

echo "${green}Installing requirements${reset}"
{{ if eq .chezmoi.osRelease.id "ubuntu" "debian" }}
  sudo apt-get update && \
        sudo apt-get -y install git lsb-release curl zsh \
            tomb python3-pip gnupg2 pcscd scdaemon pcsc-tools \
            yubikey-manager
{{ else if eq .chezmoi.osRelease.id "arch" }}
    paru -S --noconfirm --needed git curl zsh run-parts unzip
{{ else if eq .chezmoi.osRelease.id "fedora" }}
    sudo dnf install -y git zsh redhat-lsb-core yubikey-manager python3-pip
{{ else if eq .chezmoi.osRelease.id "opensuse-leap" "opensuse-tumbleweed" }}
    sudo zypper install -y git zsh python3-pip
{{ end }}

echo "${green}Installing gita and cloning .vendor requirements${reset}"
if [[ ! -e {{ .chezmoi.homeDir }}/.local/bin/gita ]]; then
  pip3 install --user gita
else
  pip3 install --upgrade --user gita
fi
$HOME/.local/bin/gita clone -f {{ .chezmoi.sourceDir }}/.gita.vendor.frozen -p
