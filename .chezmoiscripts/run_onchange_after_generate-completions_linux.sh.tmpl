#!/bin/bash
# run_onchange_after - generates shell completions for installed binaries
{{- $versions := includeTemplate "externals/versions-binaries.toml" . | fromToml -}}
{{- $externalsCtx := merge (dict "versions" $versions.versions) . -}}
# Dependencies hash: {{ includeTemplate "externals/externals-binaries.toml" $externalsCtx | sha256sum }}

set -euo pipefail

echo "Generating shell completions..."

# Completion directories
BASH_COMPLETIONS="${XDG_DATA_HOME:-${HOME}/.local/share}/bash-completion/completions"
ZSH_COMPLETIONS="${HOME}/.zsh/.zsh_completions.d"

# Create completion directories
mkdir -p "${BASH_COMPLETIONS}"
mkdir -p "${ZSH_COMPLETIONS}"

# Helper function to generate completions
# Usage: generate_completion <command> <bash-args> <zsh-args>
generate_completion() {
  local cmd="$1"
  local bash_args="$2"
  local zsh_args="$3"

  if command -v "$cmd" &>/dev/null; then
    echo "  Generating $cmd completions..."
    $cmd "$bash_args" >"${BASH_COMPLETIONS}/${cmd}" 2>/dev/null || true
    $cmd "$zsh_args" >"${ZSH_COMPLETIONS}/_${cmd}" 2>/dev/null || true
  fi
}

# Generate completions for all tools
# generate_completion "custom-tool" "--completions bash" "--completions zsh"

# echo "  Shell completions generated"
