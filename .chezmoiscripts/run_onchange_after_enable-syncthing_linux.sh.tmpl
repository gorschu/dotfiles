#!/bin/bash
# run_onchange_after - runs whenever the hash of this file or syncthing.container changes
# Hash: {{ include "dot_config/containers/systemd/syncthing.container" | sha256sum }}

set -euo pipefail

echo "Setting up Syncthing synchronization service..."

# Create required directories
mkdir -p "${HOME}/.config/syncthing"
mkdir -p "${HOME}/Sync"

# Reload systemd user daemon to pick up the new quadlet
systemctl --user daemon-reload

# Enable and start the service
# The quadlet will be automatically converted to syncthing.service by systemd
echo "Enabling syncthing service..."
systemctl --user enable --now syncthing.service

# Check status
if systemctl --user is-active --quiet syncthing.service; then
    echo "✓ Syncthing service is running"
    echo "  Access the web UI at: http://localhost:8384"
else
    echo "⚠ Syncthing service failed to start"
    systemctl --user status syncthing.service --no-pager || true
    exit 1
fi
