#!/bin/bash
# run_onchange_after - runs whenever the hash of this file or syncthing.container changes
# Hash: {{ include "dot_config/containers/systemd/syncthing.container" | sha256sum }}

set -euo pipefail

echo "Setting up Syncthing synchronization service..."

# Reload systemd user daemon to pick up the new quadlet
systemctl --user daemon-reload

# Start the service if not already running
if systemctl --user is-active --quiet syncthing.service; then
    echo "Syncthing service already running, restarting to pick up changes..."
    systemctl --user restart syncthing.service
else
    echo "Starting syncthing service..."
    systemctl --user start syncthing.service
fi

# Check status
if systemctl --user is-active --quiet syncthing.service; then
  echo "✓ Syncthing service is running"
  echo "  Access the web UI at: http://localhost:8384"
else
  echo "⚠ Syncthing service failed to start"
  systemctl --user status syncthing.service --no-pager || true
  exit 1
fi
