---
# Base system configuration - repositories and core utilities

- name: Install RPM Fusion repositories
  become: true
  ansible.builtin.dnf:
    name:
      - >-
        https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-{{
        ansible_distribution_major_version }}.noarch.rpm
      - >-
        https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{
        ansible_distribution_major_version }}.noarch.rpm
    state: present
    disable_gpg_check: true

- name: Enable COPR repositories
  become: true
  community.general.copr:
    name: scottames/ghostty
    state: enabled

- name: Add scootersoftware repository
  become: true
  ansible.builtin.get_url:
    url: https://www.scootersoftware.com/files/scootersoftware.repo
    dest: /etc/yum.repos.d/scootersoftware.repo
    mode: "0644"

- name: Add scootersoftware GPG key
  become: true
  ansible.builtin.rpm_key:
    state: present
    key: https://www.scootersoftware.com/RPM-GPG-KEY-scootersoftware

- name: Check if ZFS kernel module is available
  ansible.builtin.command: modinfo zfs
  register: base_zfs_module_check
  changed_when: false
  failed_when: false

- name: Add zrepl repository
  become: true
  ansible.builtin.copy:
    src: zrepl.repo
    dest: /etc/yum.repos.d/zrepl.repo
    mode: "0644"
  when: base_zfs_module_check.rc == 0

- name: Install system utilities
  become: true
  ansible.builtin.dnf:
    name:
      - gdisk
      - parted
    state: present

- name: Install zrepl
  become: true
  ansible.builtin.dnf:
    name: zrepl
    state: present
  when: base_zfs_module_check.rc == 0

- name: Install CLI tools
  become: true
  ansible.builtin.dnf:
    name:
      - fzf
      - ripgrep
      - fd-find
      - bat
      - zoxide
      - zsh
      - neovim
      - btop
      - bsdtar
    state: present

- name: Install development toolchains
  become: true
  ansible.builtin.dnf:
    name:
      - rustup
      - cargo
      - rust
      - golang
      - uv
      - lua
      - luarocks
    state: present

- name: Install networking tools
  become: true
  ansible.builtin.dnf:
    name:
      - NetworkManager-tui
      - network-manager-applet
    state: present
